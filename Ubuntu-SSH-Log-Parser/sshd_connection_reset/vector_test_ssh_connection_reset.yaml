tests:
  - name: "Verify SSH connection reset parsing"
    inputs:
      - insert_at: "parse_connection_reset"
        type: "log"
        log_fields:
          message: "Feb 20 10:48:39 mihir-ubuntu sshd[15112]: Connection reset by invalid user mihirs 192.168.186.1 port 62747 [preauth]"

    outputs:
      - extract_from: "parse_connection_reset"
        conditions:
          - type: "vrl"
            source: |
              # Validate expected fields and values
              assert!(exists(.timestamp), "timestamp missing")
              assert_eq!(.timestamp, "Feb 20 10:48:39", "unexpected timestamp value")

              assert!(exists(.program), "program missing")
              assert_eq!(.program, "sshd", "unexpected program value")

              assert!(exists(.appname), "appname missing")
              assert_eq!(.appname, "sshd", "unexpected appname value")

              assert!(exists(.pid), "pid missing")
              assert_eq!(.pid, 15112, "unexpected pid value")


              assert!(exists(.username), "username missing")
              assert_eq!(.username, "mihirs", "unexpected username value")


              assert!(exists(.port), "port missing")
              assert_eq!(.port, 62747, "unexpected port value")

              assert!(exists(.status), "status missing")
              assert_eq!(.status, "preauth", "unexpected status value")
