tests:
  - name: "Verify usermod shell change parsing"
    inputs:
      - insert_at: "parse_usermod"
        type: "log"
        log_fields:
          message: "Feb 20 10:42:00 mihir-ubuntu usermod[3171]: change user 'test' shell from '/bin/bash' to '/usr/sbin/nologin'"

    outputs:
      - extract_from: "parse_usermod"
        conditions:
          - type: "vrl"
            source: |
              # Ensure expected fields exist and have correct values
              assert!(exists(.timestamp), "timestamp missing")
              assert_eq!(.timestamp, "Feb 20 10:42:00", "unexpected timestamp value")

              assert!(exists(.hostname), "hostname missing")
              assert_eq!(.hostname, "mihir-ubuntu", "unexpected hostname value")

              assert!(exists(.program), "program missing")
              assert_eq!(.program, "usermod", "unexpected program value")

              assert!(exists(.appname), "appname missing")
              assert_eq!(.appname, "usermod", "unexpected appname value")

              assert!(exists(.pid), "pid missing")
              assert_eq!(.pid, 3171, "unexpected pid value")

              assert!(exists(.user), "user missing")
              assert_eq!(.user, "test", "unexpected user value")

              assert!(exists(.old_shell), "old_shell missing")
              assert_eq!(.old_shell, "/bin/bash", "unexpected old_shell value")

              assert!(exists(.new_shell), "new_shell missing")
              assert_eq!(.new_shell, "/usr/sbin/nologin", "unexpected new_shell value")

              assert!(exists(.event_type), "event_type missing")
              assert_eq!(.event_type, "usermod_change_user_shell", "unexpected event_type value")
